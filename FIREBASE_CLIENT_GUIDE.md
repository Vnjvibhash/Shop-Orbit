# Firebase Client Code Guide

## Overview

This guide explains the Firebase client code structure and usage for the ShopOrbit Shopping App. The project includes comprehensive Firebase integration with authentication, Firestore database, and sample data initialization.

## Project Structure

```
lib/
├── firebase_options.dart              # Firebase configuration
├── data_schema.dart                   # Database schema documentation
├── sample_data.dart                   # Sample data for initialization
├── models/                           # Data models
│   ├── user_model.dart
│   ├── product_model.dart
│   ├── order_model.dart
│   ├── category_model.dart
│   └── review_model.dart
├── services/                         # Service layer
│   ├── auth_service.dart
│   ├── firestore_service.dart
│   └── data_initialization_service.dart
├── repositories/                     # Repository pattern
│   └── firebase_repository.dart
└── providers/                        # State management
    ├── auth_provider.dart
    └── cart_provider.dart

Root files:
├── firebase.json                     # Firebase configuration
├── firestore.rules                   # Firestore security rules
└── firestore.indexes.json            # Firestore indexes
```

## Key Components

### 1. Firebase Configuration

**firebase_options.dart**

- Contains platform-specific Firebase configuration
- Auto-generated by FlutterFire CLI
- Includes API keys and project settings for web, Android, and iOS

**firebase.json**

- Defines Firebase project settings
- Configures Firestore rules and indexes deployment
- Sets up hosting configuration

### 2. Data Models

All models include:

- `fromJson()` and `toJson()` methods for Firestore serialization
- `copyWith()` method for immutable updates
- Proper timestamp handling with Firestore Timestamp

**UserModel**

- Represents users with roles (admin, seller, user)
- Includes approval status for sellers
- Supports multiple addresses and profile images

**ProductModel**

- Complete product information including images, pricing, inventory
- Category and subcategory support
- Rating and review count tracking

**OrderModel**

- Order management with multiple items
- Status tracking (pending, confirmed, shipped, delivered, cancelled)
- Payment and shipping information

**CategoryModel**

- Product categorization with subcategories
- Active/inactive status management
- Image support for category display

**ReviewModel**

- Product reviews with ratings and comments
- User information for review display
- Timestamp tracking for review ordering

### 3. Services Layer

**AuthService**

- Firebase Authentication integration
- User registration and login
- Profile management
- Session handling

**FirestoreService**

- Direct Firestore operations
- CRUD operations for all collections
- Query optimization
- Error handling

**DataInitializationService**

- Sample data population
- Database reset functionality
- Initialization status tracking
- User account creation

### 4. Repository Pattern

**FirebaseRepository**

- Centralized data access layer
- Combines authentication and Firestore operations
- Real-time streams for live updates
- Batch operations for efficiency
- Search functionality
- Analytics data aggregation

## Database Schema

### Collections

1. **users**

   - User accounts with role-based access
   - Fields: id, email, name, role, profileImage, addresses, isBlocked, isApproved, timestamps

2. **categories**

   - Product categories and subcategories
   - Fields: id, name, description, imageUrl, subcategories, isActive, timestamps

3. **products**

   - Product catalog with full details
   - Fields: id, sellerId, name, description, price, images, category, brand, inventory, ratings, timestamps

4. **orders**

   - Customer orders with items and status
   - Fields: id, userId, sellerId, items, totalAmount, status, shippingAddress, payment info, timestamps

5. **reviews**
   - Product reviews and ratings
   - Fields: id, userId, productId, rating, comment, user info, timestamps

### Indexes

Composite indexes are configured for:

- Products: category + createdAt
- Orders: userId + createdAt
- Orders: sellerId + createdAt
- Reviews: productId + createdAt

## Security Rules

Firestore rules allow:

- All authenticated users can read/write all collections
- Authentication is required for all operations
- Rules can be customized for more granular permissions

## Usage Examples

### 1. Authentication

```dart
// Initialize in main.dart
await Firebase.initializeApp(
  options: DefaultFirebaseOptions.currentPlatform,
);

// Using AuthService
final authService = AuthService();

// Sign in
final user = await authService.signInWithEmailAndPassword(email, password);

// Register
final user = await authService.registerWithEmailAndPassword(
  email: email,
  password: password,
  name: name,
  role: 'user',
);
```

### 2. Data Operations

```dart
// Using FirebaseRepository
final repository = FirebaseRepository();

// Get products
final products = await repository.getAllProducts();
final categoryProducts = await repository.getProductsByCategory('Electronics');

// Create order
final order = OrderModel(/* order data */);
final orderId = await repository.createOrder(order);

// Real-time updates
repository.getProductsStream().listen((products) {
  // Handle product updates
});
```

### 3. Data Initialization

```dart
// Initialize sample data
final dataService = DataInitializationService();

// Check if data exists
final hasData = await dataService.hasSampleData();

// Initialize all sample data
if (!hasData) {
  await dataService.initializeAllSampleData();
  await dataService.createSampleUserAccounts();
}
```

## Sample Data

The project includes comprehensive sample data:

- **5 users**: 1 admin, 2 sellers, 2 customers
- **5 categories**: Electronics, Fashion, Home & Garden, Sports, Books
- **10 products**: Diverse product catalog across categories
- **3 orders**: Different order statuses and sellers
- **4 reviews**: Product reviews with ratings

Sample user accounts:

- admin@ShopOrbit.com (admin)
- seller1@example.com (seller - Electronics Store)
- seller2@example.com (seller - Fashion Hub)
- user1@example.com (customer - John Doe)
- user2@example.com (customer - Jane Smith)

Default password for all sample accounts: `password123`

## Key Features

1. **Multi-role Authentication**: Admin, seller, and user roles with different permissions
2. **Product Management**: Complete catalog with categories, images, and inventory
3. **Order Processing**: Full order lifecycle management
4. **Review System**: Product ratings and reviews
5. **Real-time Updates**: Live data synchronization
6. **Search Functionality**: Product search capabilities
7. **Analytics**: Dashboard analytics for admins
8. **Batch Operations**: Efficient data operations

## Best Practices Implemented

1. **Repository Pattern**: Centralized data access
2. **Error Handling**: Comprehensive error management
3. **Type Safety**: Strongly typed models
4. **Performance**: Optimized queries and indexes
5. **Security**: Authentication-based access control
6. **Scalability**: Efficient data structure design
7. **Maintainability**: Clean code architecture

## Deployment

To deploy Firebase configuration:

```bash
# Deploy Firestore rules and indexes
firebase deploy --only firestore
```

This command deploys:

- Firestore security rules
- Firestore indexes
- Any hosting configuration

## Notes

- All timestamps use Firestore Timestamp for consistency
- Document IDs are auto-generated for better distribution
- Sample data uses placeholder URLs for images
- Real-time listeners are implemented for live updates
- Error handling includes user-friendly messages
- The code follows Flutter best practices and conventions

## Getting Started

1. Ensure Firebase project is configured
2. Run `flutter pub get` to install dependencies
3. Initialize the app with sample data on first run
4. Use the provided services and repositories in your UI components
5. Customize security rules as needed for your use case

This Firebase client code provides a solid foundation for a multi-role e-commerce application with comprehensive data management capabilities.
